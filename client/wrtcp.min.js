(function(K,l){K(["module"],function(m){function n(c,d,g){Array.isArray(g)||(g=[g]);d in c&&"function"===typeof c[d]&&c[d].apply(c,g)}function r(c,d,g){g instanceof Error||(g=Error(g));n(c,d,[g])}function L(c,d,g,p){return c?(c.push([d,g,p]),!0):!1}function M(c){for(;c.length;){var d=c.shift();n(d[0],d[1],d[2])}}function j(c){this.brokerUrl=c;this.state=j.OFFLINE;this.route=this.socket=this.onerror=this.onreceive=this.onstatechange=null}function t(c){this.onerror=this.oncomplete=this.onmessage=null;
this.complete=!1;this.options=c;this.options.ports={local:T++,remote:null};this.options.streams={local:null,remote:null};this.peerConnection=null}function E(c,d,g){function p(){++v;3===v&&(k.connected=!0,this.connectionTimer=window.setTimeout(h,d.connectionTimeout),n(k,"onconnect",[]))}function h(){k.connected&&(this.connectionTimer=null,!1===u?(console.log("sending ping"),m.send("PING"),this.pingTimer=window.setTimeout(b,d.pingTimeout)):(u=!1,this.connectionTimer=window.setTimeout(h,d.connectionTimeout)))}
function b(){k.connected&&(this.pingTimer=null,!1===u?(k.connected=!1,k.close()):(u=!1,this.connectionTimer=window.setTimeout(h,d.connectionTimeout)))}var k=this;this.id=U++;this.streams=d.streams;this.connected=!1;this.onerror=this.ondisconnect=this.onconnect=null;this.peerConnection=c;var j=null,l=null,m=null;this.reliable={send:null,onmessage:null,_channel:null};this.unreliable={send:null,onmessage:null,_channel:null};this._control=null;var v=0,u=!1;this.pingTimer=this.connectionTimer=null;g?this.peerConnection.onconnection=
function(){j=c.createDataChannel("reliable",V);l=c.createDataChannel("unreliable",R);m=c.createDataChannel("control",R);j.binaryType=d.binaryType;l.binaryType=d.binaryType;m.bineryType="arraybuffer";j.onopen=p;l.onopen=p;m.onopen=p;k.reliable.send=function(b){j.send(b)};k.unreliable.send=function(b){l.send(b)};k.reliable._channel=j;k.unreliable._channel=l;k._control=m;j.onmessage=function(b){u=!0;k.connected&&n(k.reliable,"onmessage",[b])};l.onmessage=function(b){u=!0;k.connected&&n(k.unreliable,
"onmessage",[b])};m.onmessage=function(b){u=!0;k.connected&&(b=b.data,"PING"===b?(console.log("received ping, sending pong"),m.send("PONG")):"PONG"===b?console.log("received pong"):"QUIT"===b&&(console.log("received quit"),k.close()))}}:this.peerConnection.ondatachannel=function(b){if("reliable"===b.label)j=k.reliable._channel=b,k.reliable.send=function(d){b.send(d)},b.onmessage=function(b){u=!0;k.connected&&n(k.reliable,"onmessage",[b])};else if("unreliable"===b.label)l=k.unreliable._channel=b,k.unreliable.send=
function(d){b.send(d)},b.onmessage=function(b){u=!0;k.connected&&n(k.unreliable,"onmessage",[b])};else if("control"===b.label)m=k._control=b,b.onmessage=function(b){u=!0;k.connected&&(b=b.data,"PING"===b?(console.log("received ping, sending pong"),m.send("PONG")):"PONG"===b?console.log("received pong"):"QUIT"===b&&(console.log("received quit"),k.connected=!1,k.close()))};else return r(k,"onerror","unknown data channel"+b.label);"reliable"===b.label||"unreliable"===b.label?b.binaryType=d.binaryType:
"control"===b.label&&(b.binaryType="arraybuffer");j&&(l&&m)&&(k.connected=!0,this.connectionTimer=window.setTimeout(h,d.connectionTimeout),n(k,"onconnect",[]))};k.peerConnection.connectDataConnection(d.ports.local,d.ports.remote)}function F(c,d){var g=this;this.brokerUrl=c;this.options=d=d||{};d.binaryType=d.binaryType||"arraybuffer";d.connectionTimeout=d.connectionTimeout||10*S;d.pingTimeout=d.pingTimeout||1*S;this.onerror=this.onroute=this.onpending=this.onconnection=null;this.broker=new j(c);this.pending=
{};this.queues={connected:[],listening:[]};this.broker.onstatechange=function(d,c){g.queues.connected.length&&g.broker.checkState(j.ROUTED)&&(M(g.queues.connected),g.queues.listening.length&&g.broker.checkState(j.LISTENING)&&M(g.queues.listening));c&j.ROUTED&&n(g,"onroute",g.broker.route)};this.broker.onreceive=function(d,c){var b;if(g.pending.hasOwnProperty(d))b=g.pending[d];else{if(!g.broker.checkState(j.LISTENING)){r(g,"onerror","pending connection but peer is not listening");return}n(g,"onpending",
[d]);b=g.pending[d]=new t(g.options);b.oncomplete=function(b){delete g.pending[d];b.route=d;b.onconnect=function(){n(g,"onconnection",[b])}};b.onmessage=function(b){g.broker.send(d,b)};b.onerror=function(b){delete g.pending[d];n(g,"onerror",[b])}}b.process(c)};this.broker.connect()}var h="undefined"===typeof m?{}:m.exports;(function(){var c="object"===typeof m?m.exports:h={};c.version="0.9.11";c.protocol=1;c.transports=[];c.j=[];c.sockets={};c.connect=function(a,f){var e=c.util.parseUri(a),b,d;l&&
l.location&&(e.protocol=e.protocol||l.location.protocol.slice(0,-1),e.host=e.host||(l.document?l.document.domain:l.location.hostname),e.port=e.port||l.location.port);b=c.util.uniqueUri(e);var g={host:e.host,secure:"https"==e.protocol,port:e.port||("https"==e.protocol?443:80),query:e.query||""};c.util.merge(g,f);if(g["force new connection"]||!c.sockets[b])d=new c.Socket(g);!g["force new connection"]&&d&&(c.sockets[b]=d);d=d||c.sockets[b];return d.of(1<e.path.length?e.path:"")};var d=("undefined"!=
typeof h?h:m.exports).util={},g=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,p="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");d.parseUri=function(a){a=g.exec(a||"");for(var f={},e=14;e--;)f[p[e]]=a[e]||"";return f};d.uniqueUri=function(a){var f=a.protocol,e=a.host;a=a.port;"document"in
l?(e=e||document.domain,a=a||("https"==f&&"https:"!==document.location.protocol?443:document.location.port)):(e=e||"localhost",!a&&"https"==f&&(a=443));return(f||"http")+"://"+e+":"+(a||80)};d.query=function(a,f){var e=d.chunkQuery(a||""),b=[];d.merge(e,d.chunkQuery(f||""));for(var c in e)e.hasOwnProperty(c)&&b.push(c+"="+e[c]);return b.length?"?"+b.join("&"):""};d.chunkQuery=function(a){var f={};a=a.split("&");for(var e=0,b=a.length,d;e<b;++e)d=a[e].split("="),d[0]&&(f[d[0]]=d[1]);return f};var j=
!1;d.load=function(a){if("document"in l&&"complete"===document.readyState||j)return a();d.on(l,"load",a,!1)};d.on=function(a,f,e,b){a.attachEvent?a.attachEvent("on"+f,e):a.addEventListener&&a.addEventListener(f,e,b)};d.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!d.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||d.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(f){}return null};
"undefined"!=typeof window&&d.load(function(){j=!0});d.defer=function(a){if(!d.ua.webkit||"undefined"!=typeof importScripts)return a();d.load(function(){setTimeout(a,100)})};d.merge=function(a,f,e,b){b=b||[];e="undefined"==typeof e?2:e;for(var c in f)f.hasOwnProperty(c)&&0>d.indexOf(b,c)&&("object"!==typeof a[c]||!e?(a[c]=f[c],b.push(f[c])):d.merge(a[c],f[c],e-1,b));return a};d.mixin=function(a,f){d.merge(a.prototype,f.prototype)};d.inherit=function(a,f){function e(){}e.prototype=f.prototype;a.prototype=
new e};d.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.intersect=function(a,f){for(var e=[],b=a.length>f.length?a:f,c=a.length>f.length?f:a,g=0,h=c.length;g<h;g++)~d.indexOf(b,c[g])&&e.push(c[g]);return e};d.indexOf=function(a,f,e){var b=a.length;for(e=0>e?0>e+b?0:e+b:e||0;e<b&&a[e]!==f;e++);return b<=e?-1:e};d.toArray=function(a){for(var f=[],e=0,b=a.length;e<b;e++)f.push(a[e]);return f};d.ua={};var b=d.ua,k;if(k="undefined"!=typeof XMLHttpRequest)a:{try{var n=
new XMLHttpRequest}catch(r){k=!1;break a}k=void 0!=n.withCredentials}b.hasCORS=k;d.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);d.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent);var t="undefined"!=typeof h?h:m.parent.exports,b=function(){};("undefined"!=typeof h?h:m.exports).EventEmitter=b;b.prototype.on=function(a,f){this.$events||(this.$events={});this.$events[a]?t.util.isArray(this.$events[a])?this.$events[a].push(f):this.$events[a]=
[this.$events[a],f]:this.$events[a]=f;return this};b.prototype.addListener=b.prototype.on;b.prototype.once=function(a,f){function e(){b.removeListener(a,e);f.apply(this,arguments)}var b=this;e.listener=f;this.on(a,e);return this};b.prototype.removeListener=function(a,f){if(this.$events&&this.$events[a]){var e=this.$events[a];if(t.util.isArray(e)){for(var b=-1,d=0,c=e.length;d<c;d++)if(e[d]===f||e[d].listener&&e[d].listener===f){b=d;break}if(0>b)return this;e.splice(b,1);e.length||delete this.$events[a]}else(e===
f||e.listener&&e.listener===f)&&delete this.$events[a]}return this};b.prototype.removeAllListeners=function(a){if(void 0===a)return this.$events={},this;this.$events&&this.$events[a]&&(this.$events[a]=null);return this};b.prototype.listeners=function(a){this.$events||(this.$events={});this.$events[a]||(this.$events[a]=[]);t.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]);return this.$events[a]};b.prototype.emit=function(a){if(!this.$events)return!1;var f=this.$events[a];if(!f)return!1;
var e=Array.prototype.slice.call(arguments,1);if("function"==typeof f)f.apply(this,e);else if(t.util.isArray(f))for(var f=f.slice(),b=0,d=f.length;b<d;b++)f[b].apply(this,e);else return!1;return!0};(function(a,f){function e(a){return 10>a?"0"+a:a}function b(a){h.lastIndex=0;return h.test(a)?'"'+a.replace(h,function(a){var f=k[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,f){var c,g,h,k,O=p,m,s=f[a];s instanceof Date&&(s=isFinite(a.valueOf())?
a.getUTCFullYear()+"-"+e(a.getUTCMonth()+1)+"-"+e(a.getUTCDate())+"T"+e(a.getUTCHours())+":"+e(a.getUTCMinutes())+":"+e(a.getUTCSeconds())+"Z":null);"function"===typeof l&&(s=l.call(f,a,s));switch(typeof s){case "string":return b(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);case "object":if(!s)return"null";p+=j;m=[];if("[object Array]"===Object.prototype.toString.apply(s)){k=s.length;for(c=0;c<k;c+=1)m[c]=d(c,s)||"null";h=0===m.length?"[]":p?"[\n"+
p+m.join(",\n"+p)+"\n"+O+"]":"["+m.join(",")+"]";p=O;return h}if(l&&"object"===typeof l){k=l.length;for(c=0;c<k;c+=1)"string"===typeof l[c]&&(g=l[c],(h=d(g,s))&&m.push(b(g)+(p?": ":":")+h))}else for(g in s)Object.prototype.hasOwnProperty.call(s,g)&&(h=d(g,s))&&m.push(b(g)+(p?": ":":")+h);h=0===m.length?"{}":p?"{\n"+p+m.join(",\n"+p)+"\n"+O+"}":"{"+m.join(",")+"}";p=O;return h}}if(f&&f.parse)return a.JSON={parse:f.parse,stringify:f.stringify};var c=a.JSON={},g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p,j,k={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;c.stringify=function(a,f,e){var b;j=p="";if("number"===typeof e)for(b=0;b<e;b+=1)j+=" ";else"string"===typeof e&&(j=e);if((l=f)&&"function"!==typeof f&&("object"!==typeof f||"number"!==typeof f.length))throw Error("JSON.stringify");return d("",{"":a})};c.parse=function(a,f){function e(a,b){var d,
c,g=a[b];if(g&&"object"===typeof g)for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(c=e(g,d),void 0!==c?g[d]=c:delete g[d]);return f.call(a,b,g)}var b;a=String(a);g.lastIndex=0;g.test(a)&&(a=a.replace(g,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),
"function"===typeof f?e({"":b},""):b;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof h?h:m.exports,"undefined"!==typeof JSON?JSON:void 0);var b="undefined"!=typeof h?h:m.parent.exports,v=("undefined"!=typeof h?h:m.exports).parser={},u=v.packets="disconnect connect heartbeat message json event ack error noop".split(" "),z=v.reasons=["transport not supported","client not handshaken","unauthorized"],F=v.advice=["reconnect"],G=b.JSON,D=b.util.indexOf;v.encodePacket=function(a){var f=D(u,a.type),
e=a.id||"",b=a.endpoint||"",d=a.ack,c=null;switch(a.type){case "error":var g=a.reason?D(z,a.reason):"";a=a.advice?D(F,a.advice):"";if(""!==g||""!==a)c=g+(""!==a?"+"+a:"");break;case "message":""!==a.data&&(c=a.data);break;case "event":c={name:a.name};a.args&&a.args.length&&(c.args=a.args);c=G.stringify(c);break;case "json":c=G.stringify(a.data);break;case "connect":a.qs&&(c=a.qs);break;case "ack":c=a.ackId+(a.args&&a.args.length?"+"+G.stringify(a.args):"")}f=[f,e+("data"==d?"+":""),b];null!==c&&void 0!==
c&&f.push(c);return f.join(":")};v.encodePayload=function(a){var f="";if(1==a.length)return a[0];for(var e=0,b=a.length;e<b;e++)f+="\ufffd"+a[e].length+"\ufffd"+a[e];return f};var I=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;v.decodePacket=function(a){var f=a.match(I);if(!f)return{};var e=f[2]||"";a=f[5]||"";var b={type:u[f[1]],endpoint:f[4]||""};e&&(b.id=e,b.ack=f[3]?"data":!0);switch(b.type){case "error":f=a.split("+");b.reason=z[f[0]]||"";b.advice=F[f[1]]||"";break;case "message":b.data=a||
"";break;case "event":try{var c=G.parse(a);b.name=c.name;b.args=c.args}catch(d){}b.args=b.args||[];break;case "json":try{b.data=G.parse(a)}catch(g){}break;case "connect":b.qs=a||"";break;case "ack":if(f=a.match(/^([0-9]+)(\+)?(.*)/))if(b.ackId=f[1],b.args=[],f[3])try{b.args=f[3]?G.parse(f[3]):[]}catch(h){}}return b};v.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var f=[],b=1,c="";b<a.length;b++)"\ufffd"==a.charAt(b)?(f.push(v.decodePacket(a.substr(b+1).substr(0,c))),b+=Number(c)+1,c=""):
c+=a.charAt(b);return f}return[v.decodePacket(a)]};var N="undefined"!=typeof h?h:m.parent.exports,b=function(a,f){this.socket=a;this.sessid=f};("undefined"!=typeof h?h:m.exports).Transport=b;N.util.mixin(b,N.EventEmitter);b.prototype.heartbeats=function(){return!0};b.prototype.onData=function(a){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==a&&(a=N.parser.decodePayload(a))&&a.length)for(var f=0,b=a.length;f<b;f++)this.onPacket(a[f]);
return this};b.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1);this.socket.onPacket(a);return this};b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};b.prototype.onDisconnect=function(){this.isOpen&&this.close();this.clearTimeouts();
this.socket.onDisconnect();return this};b.prototype.onConnect=function(){this.socket.onConnect();return this};b.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)};b.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};b.prototype.packet=function(a){this.send(N.parser.encodePacket(a))};b.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})};b.prototype.onOpen=function(){this.isOpen=
!0;this.clearCloseTimeout();this.socket.onOpen()};b.prototype.onClose=function(){this.isOpen=!1;this.socket.onClose();this.onDisconnect()};b.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+N.protocol+"/"+this.name+"/"+this.sessid};b.prototype.ready=function(a,f){f.call(this)};var q="undefined"!=typeof h?h:m.parent.exports,b=function(a){this.options={port:80,secure:!1,document:"document"in l?document:!1,resource:"socket.io",
transports:q.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1};q.util.merge(this.options,a);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||q.util.ua.hasCORS)){var f=
this;q.util.on(l,"beforeunload",function(){f.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()},J=function(){};("undefined"!=typeof h?h:m.exports).Socket=b;q.util.mixin(b,q.EventEmitter);b.prototype.of=function(a){this.namespaces[a]||(this.namespaces[a]=new q.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"}));return this.namespaces[a]};b.prototype.publish=function(){this.emit.apply(this,arguments);var a,f;for(f in this.namespaces)this.namespaces.hasOwnProperty(f)&&
(a=this.of(f),a.$emit.apply(a,arguments))};b.prototype.handshake=function(a){function f(f){f instanceof Error?(b.connecting=!1,b.onError(f.message)):a.apply(null,f.split(":"))}var b=this,c=this.options,c=["http"+(c.secure?"s":"")+":/",c.host+":"+c.port,c.resource,q.protocol,q.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!q.util.ua.hasCORS){var d=document.getElementsByTagName("script")[0],g=document.createElement("script");g.src=c+"&jsonp="+q.j.length;d.parentNode.insertBefore(g,
d);q.j.push(function(a){f(a);g.parentNode.removeChild(g)})}else{var h=q.util.request();h.open("GET",c,!0);this.isXDomain()&&(h.withCredentials=!0);h.onreadystatechange=function(){if(4==h.readyState)if(h.onreadystatechange=J,200==h.status)f(h.responseText);else if(403==h.status)b.onError(h.responseText);else b.connecting=!1,!b.reconnecting&&b.onError(h.responseText)};h.send(null)}};b.prototype.getTransport=function(a){a=a||this.transports;for(var f=0,b;b=a[f];f++)if(q.Transport[b]&&q.Transport[b].check(this)&&
(!this.isXDomain()||q.Transport[b].xdomainCheck(this)))return new q.Transport[b](this,this.sessionid);return null};b.prototype.connect=function(a){if(this.connecting)return this;var f=this;f.connecting=!0;this.handshake(function(b,c,d,g){function h(a){f.transport&&f.transport.clearTimeouts();f.transport=f.getTransport(a);if(!f.transport)return f.publish("connect_failed");f.transport.ready(f,function(){f.connecting=!0;f.publish("connecting",f.transport.name);f.transport.open();f.options["connect timeout"]&&
(f.connectTimeoutTimer=setTimeout(function(){if(!f.connected&&(f.connecting=!1,f.options["try multiple transports"])){for(var a=f.transports;0<a.length&&a.splice(0,1)[0]!=f.transport.name;);a.length?h(a):f.publish("connect_failed")}},f.options["connect timeout"]))})}f.sessionid=b;f.closeTimeout=1E3*d;f.heartbeatTimeout=1E3*c;f.transports||(f.transports=f.origTransports=g?q.util.intersect(g.split(","),f.options.transports):f.options.transports);f.setHeartbeatTimeout();h(f.transports);f.once("connect",
function(){clearTimeout(f.connectTimeoutTimer);a&&"function"==typeof a&&a()})});return this};b.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}};b.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};b.prototype.setBuffer=function(a){this.doBuffer=
a;!a&&(this.connected&&this.buffer.length)&&(this.options.manualFlush||this.flushBuffer())};b.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};b.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};b.prototype.disconnectSync=function(){var a=q.util.request(),b=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,
q.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",b,!1);a.send(null);this.onDisconnect("booted")};b.prototype.isXDomain=function(){var a=l.location.port||("https:"==l.location.protocol?443:80);return this.options.host!==l.location.hostname||this.options.port!=a};b.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};b.prototype.onOpen=function(){this.open=!0};b.prototype.onClose=function(){this.open=
!1;clearTimeout(this.heartbeatTimeoutTimer)};b.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};b.prototype.onError=function(a){if(a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting))this.disconnect(),this.options.reconnect&&this.reconnect();this.publish("error",a&&a.reason?a.reason:a)};b.prototype.onDisconnect=function(a){var b=this.connected,e=this.connecting;this.open=this.connecting=this.connected=!1;if(b||e)this.transport.close(),this.transport.clearTimeouts(),
b&&(this.publish("disconnect",a),"booted"!=a&&(this.options.reconnect&&!this.reconnecting)&&this.reconnect())};b.prototype.reconnect=function(){function a(){if(e.connected){for(var a in e.namespaces)e.namespaces.hasOwnProperty(a)&&""!==a&&e.namespaces[a].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer);e.removeListener("connect_failed",b);e.removeListener("connect",b);e.reconnecting=!1;delete e.reconnectionAttempts;delete e.reconnectionDelay;
delete e.reconnectionTimer;delete e.redoTransports;e.options["try multiple transports"]=d}function b(){if(e.reconnecting){if(e.connected)return a();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(b,1E3);e.reconnectionAttempts++>=c?e.redoTransports?(e.publish("reconnect_failed"),a()):(e.on("connect_failed",b),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<g&&(e.reconnectionDelay*=
2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(b,e.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var e=this,c=this.options["max reconnection attempts"],d=this.options["try multiple transports"],g=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(b,this.reconnectionDelay);this.on("connect",
b)};var P="undefined"!=typeof h?h:m.parent.exports,b=function(a,b){this.socket=a;this.name=b||"";this.flags={};this.json=new E(this,"json");this.ackPackets=0;this.acks={}},E=function(a,b){this.namespace=a;this.name=b};("undefined"!=typeof h?h:m.exports).SocketNamespace=b;P.util.mixin(b,P.EventEmitter);b.prototype.$emit=P.EventEmitter.prototype.emit;b.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};b.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);
this.flags={};return this};b.prototype.send=function(a,b){var e={type:this.flags.json?"json":"message",data:a};"function"==typeof b&&(e.id=++this.ackPackets,e.ack=!0,this.acks[e.id]=b);return this.packet(e)};b.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),e=b[b.length-1],c={type:"event",name:a};"function"==typeof e&&(c.id=++this.ackPackets,c.ack="data",this.acks[c.id]=e,b=b.slice(0,b.length-1));c.args=b;return this.packet(c)};b.prototype.disconnect=function(){""===this.name?
this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));return this};b.prototype.onPacket=function(a){function b(){e.packet({type:"ack",args:P.util.toArray(arguments),ackId:a.id})}var e=this;switch(a.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(a.reason||"booted");else this.$emit("disconnect",a.reason);break;case "message":case "json":var c=["message",a.data];"data"==a.ack?c.push(b):a.ack&&this.packet({type:"ack",
ackId:a.id});this.$emit.apply(this,c);break;case "event":c=[a.name].concat(a.args);"data"==a.ack&&c.push(b);this.$emit.apply(this,c);break;case "ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case "error":if(a.advice)this.socket.onError(a);else"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}};E.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};
E.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,arguments)};var H="undefined"!=typeof h?h:m.parent.exports,b=function(a){H.Transport.apply(this,arguments)};("undefined"!=typeof h?h.Transport:m.exports).websocket=b;H.util.inherit(b,H.Transport);b.prototype.name="websocket";b.prototype.open=function(){var a=H.util.query(this.socket.options.query),b=this,e;e||(e=l.MozWebSocket||l.WebSocket);this.websocket=new e(this.prepareUrl()+a);this.websocket.onopen=
function(){b.onOpen();b.socket.setBuffer(!1)};this.websocket.onmessage=function(a){b.onData(a.data)};this.websocket.onclose=function(){b.onClose();b.socket.setBuffer(!0)};this.websocket.onerror=function(a){b.onError(a)};return this};b.prototype.send=H.util.ua.iDevice?function(a){var b=this;setTimeout(function(){b.websocket.send(a)},0);return this}:function(a){this.websocket.send(a);return this};b.prototype.payload=function(a){for(var b=0,e=a.length;b<e;b++)this.packet(a[b]);return this};b.prototype.close=
function(){this.websocket.close();return this};b.prototype.onError=function(a){this.socket.onError(a)};b.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};b.check=function(){return"WebSocket"in l&&!("__addTask"in WebSocket)||"MozWebSocket"in l};b.xdomainCheck=function(){return!0};H.transports.push("websocket");if(!("undefined"==typeof window||window.WebSocket)){var x=window.console;if(!x||!x.log||!x.error)x={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?
("file:"==location.protocol&&x.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,e,c,d){var g=this;g.__id=WebSocket.__nextId++;WebSocket.__instances[g.__id]=g;g.readyState=WebSocket.CONNECTING;g.bufferedAmount=0;g.__events={};b?"string"==typeof b&&(b=[b]):b=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(g.__id,a,b,e||null,c||0,d||null)})},
0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||
(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var e=this.__events[a],c=e.length-1;0<=c;--c)if(e[c]===b){e.splice(c,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],e=0;e<b.length;++e)b[e](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||
"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=
function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var e=document.createEvent("MessageEvent");e.initMessageEvent("message",!1,!1,b,null,null,window,null);return e}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},
WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,
"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||x.error("[WebSocket] swfobject.embedSWF failed")})}else x.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=
0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(e){x.error(e)}},0);return!0},WebSocket.__log=function(a){x.log(decodeURIComponent(a))},WebSocket.__error=function(a){x.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},
WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!a||!a.enabledPlugin||!a.enabledPlugin.filename?!1:a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):x.error("Flash Player >= 10.0.0 is required.")}var B=
"undefined"!=typeof h?h:m.parent.exports,w=function(a){a&&(B.Transport.apply(this,arguments),this.sendBuffer=[])},L=function(){};("undefined"!=typeof h?h.Transport:m.exports).XHR=w;B.util.inherit(w,B.Transport);w.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};w.prototype.payload=function(a){for(var b=[],e=0,c=a.length;e<c;e++)b.push(B.parser.encodePacket(a[e]));this.send(B.parser.encodePayload(b))};w.prototype.send=function(a){this.post(a);
return this};w.prototype.post=function(a){function b(){if(4==this.readyState)if(this.onreadystatechange=L,c.posting=!1,200==this.status)c.socket.setBuffer(!1);else c.onClose()}function e(){this.onload=L;c.socket.setBuffer(!1)}var c=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");l.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=e:this.sendXHR.onreadystatechange=b;this.sendXHR.send(a)};w.prototype.close=function(){this.onClose();return this};
w.prototype.request=function(a){var b=B.util.request(this.socket.isXDomain()),e=B.util.query(this.socket.options.query,"t="+ +new Date);b.open(a||"GET",this.prepareUrl()+e,!0);if("POST"==a)try{b.setRequestHeader?b.setRequestHeader("Content-type","text/plain;charset=UTF-8"):b.contentType="text/plain"}catch(c){}return b};w.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};w.check=function(a,b){try{var e=B.util.request(b),c=l.XDomainRequest&&e instanceof XDomainRequest,d=
a&&a.options&&a.options.secure?"https:":"http:",g=l.location&&d!=l.location.protocol;if(e&&(!c||!g))return!0}catch(h){}return!1};w.xdomainCheck=function(a){return w.check(a,!0)};var C="undefined"!=typeof h?h:m.parent.exports,b=function(a){C.Transport.XHR.apply(this,arguments)};("undefined"!=typeof h?h.Transport:m.exports).htmlfile=b;C.util.inherit(b,C.Transport.XHR);b.prototype.name="htmlfile";b.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();
this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio";this.doc.body.appendChild(a);this.iframe=this.doc.createElement("iframe");a.appendChild(this.iframe);var b=this,a=C.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+a;C.util.on(window,"unload",function(){b.destroy()})};b.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}};
b.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};b.prototype.close=function(){this.destroy();return C.Transport.XHR.prototype.close.call(this)};b.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile")&&C.Transport.XHR.check(a)}catch(b){}return!1};
b.xdomainCheck=function(){return!1};C.transports.push("htmlfile");var A="undefined"!=typeof h?h:m.parent.exports,b=function(){A.Transport.XHR.apply(this,arguments)},Q=function(){};("undefined"!=typeof h?h.Transport:m.exports)["xhr-polling"]=b;A.util.inherit(b,A.Transport.XHR);A.util.merge(b,A.Transport.XHR);b.prototype.name="xhr-polling";b.prototype.heartbeats=function(){return!1};b.prototype.open=function(){A.Transport.XHR.prototype.open.call(this);return!1};b.prototype.get=function(){function a(){if(4==
this.readyState)if(this.onreadystatechange=Q,200==this.status)d.onData(this.responseText),d.get();else d.onClose()}function b(){this.onerror=this.onload=Q;d.retryCounter=1;d.onData(this.responseText);d.get()}function c(){d.retryCounter++;if(!d.retryCounter||3<d.retryCounter)d.onClose();else d.get()}if(this.isOpen){var d=this;this.xhr=this.request();l.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=c):this.xhr.onreadystatechange=a;this.xhr.send(null)}};b.prototype.onClose=
function(){A.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=Q;try{this.xhr.abort()}catch(a){}this.xhr=null}};b.prototype.ready=function(a,b){var c=this;A.util.defer(function(){b.call(c)})};A.transports.push("xhr-polling");var y="undefined"!=typeof h?h:m.parent.exports,b=function(a){y.Transport["xhr-polling"].apply(this,arguments);this.index=y.j.length;var b=this;y.j.push(function(a){b._(a)})},M=l.document&&"MozAppearance"in l.document.documentElement.style;
("undefined"!=typeof h?h.Transport:m.exports)["jsonp-polling"]=b;y.util.inherit(b,y.Transport["xhr-polling"]);b.prototype.name="jsonp-polling";b.prototype.post=function(a){function b(){c();d.socket.setBuffer(!1)}function c(){d.iframe&&d.form.removeChild(d.iframe);try{k=document.createElement('<iframe name="'+d.iframeId+'">')}catch(a){k=document.createElement("iframe"),k.name=d.iframeId}k.id=d.iframeId;d.form.appendChild(k);d.iframe=k}var d=this,g=y.util.query(this.socket.options.query,"t="+ +new Date+
"&i="+this.index);if(!this.form){var h=document.createElement("form"),p=document.createElement("textarea"),j=this.iframeId="socketio_iframe_"+this.index,k;h.className="socketio";h.style.position="absolute";h.style.top="0px";h.style.left="0px";h.style.display="none";h.target=j;h.method="POST";h.setAttribute("accept-charset","utf-8");p.name="d";h.appendChild(p);document.body.appendChild(h);this.form=h;this.area=p}this.form.action=this.prepareUrl()+g;c();this.area.value=y.JSON.stringify(a);try{this.form.submit()}catch(l){}this.iframe.attachEvent?
k.onreadystatechange=function(){"complete"==d.iframe.readyState&&b()}:this.iframe.onload=b;this.socket.setBuffer(!0)};b.prototype.get=function(){var a=this,b=document.createElement("script"),c=y.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.prepareUrl()+c;b.onerror=function(){a.onClose()};c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c);this.script=
b;M&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};b.prototype._=function(a){this.onData(a);this.isOpen&&this.get();return this};b.prototype.ready=function(a,b){var c=this;if(!M)return b.call(this);y.util.load(function(){b.call(c)})};b.check=function(){return"document"in l};b.xdomainCheck=function(){return!0};y.transports.push("jsonp-polling");"function"===typeof K&&K.amd&&K([],function(){return h})})();var D;if(window.mozRTCPeerConnection)D=
window.mozRTCPeerConnection;else if(window.webkitRTCPeerConnection)D=window.webkitRTCPeerConnection;else if(window.RTCPeerConnection)D=window.RTCPeerConnection;else throw Error("RTCPeerConnection not supported");var z;if(window.mozRTCSessionDescription)z=window.mozRTCSessionDescription;else if(window.webkitRTCSessionDescription)z=window.webkitRTCSessionDescription;else if(window.RTCSessionDescription)z=window.RTCSessionDescription;else throw Error("RTCSessionDescription not supported");var I;if(window.mozRTCIceCandidate)I=
window.mozRTCIceCandidate;else if(window.webkitRTCIceCandidate)I=window.webkitRTCIceCandidate;else if(window.RTCIceCandidate)I=window.RTCIceCandidate;else throw Error("RTCIceCandidate not supported");var J;navigator.getUserMedia?J=navigator.getUserMedia.bind(navigator):navigator.mozGetUserMedia?J=navigator.mozGetUserMedia.bind(navigator):navigator.webkitGetUserMedia&&(J=navigator.webkitGetUserMedia.bind(navigator));var S=1E3,V={},R={outOfOrderAllowed:!0,maxRetransmitNum:0};j.OFFLINE=0;j.CONNECTING=
1;j.CONNECTED=2;j.ROUTED=16;j.LISTENING=32;j.prototype.setState=function(c,d){var g=d?0:240;this.state&=g>>>0;this.state|=c>>>0;n(this,"onstatechange",[this.state,(c|g&0)>>>0])};j.prototype.setFlag=function(c){this.state=(this.state|c)>>>0;n(this,"onstatechange",[this.state,c])};j.prototype.clearFlag=function(c){c=~c>>>0;this.state=(this.state&c)>>>0;n(this,"onstatechange",[this.state,c])};j.prototype.checkState=function(c){return!!(this.state&c)};j.prototype.connect=function(){var c=this,d=h.connect(this.brokerUrl+
"/peer");d.on("connecting",function(){c.setState(j.CONNECTING,!0)});d.on("connect",function(){c.setState(j.CONNECTED,!0)});d.on("connect_failed",function(){c.setState(j.OFFLINE,!0)});d.on("route",function(d){c.route=d;c.setFlag(j.ROUTED)});d.on("disconnect",function(){c.setState(j.OFFLINE,!0)});d.on("error",function(d){r(c,"onerror",d)});d.on("receive",function(d){n(c,"onreceive",[d.from,d.data])});this.socket=d};j.prototype.disconnect=function(){return this.checkState(j.CONNECTED)?(this.socket.disconnect(),
this.state=j.OFFLINE,!0):!1};j.prototype.listen=function(c){var d=this;this.checkState(j.CONNECTED)&&this.socket.emit("listen",c,function(c){c&&c.error?r(d,"onerror",Error(c.error)):d.setFlag(j.LISTENING)})};j.prototype.ignore=function(){var c=this;this.checkState(j.CONNECTED)&&this.socket.emit("ignore",null,function(d){d&&d.error?r(c,"onerror",Error(d.error)):c.clearFlag(j.LISTENING)})};j.prototype.send=function(c,d){var g=this;this.checkState(j.CONNECTED)&&this.socket.emit("send",{to:c,data:d},
function(c){c&&c.error&&r(g,"onerror",Error(c.error))})};var W={optional:[{RtpDataChannels:!0}]},T=1;t.prototype.initialize=function(c){function d(h){h=!j&&!b?!0:h;var j=!!g.options.video,b=!!g.options.audio;J({video:j,audio:!j&&!b?!0:b,fake:h},function(b){g.peerConnection.addStream(b);g.options.streams.local=b;c()},function(b){console.error("!",b);h?r(g,"onerror",b):d(!0)})}var g=this;if(this.peerConnection)return c();this.peerConnection=new D(null,W);this.peerConnection.onicecandidate=function(c){c=
{type:"ice",candidate:JSON.stringify(c.candidate)};n(g,"onmessage",c)};this.peerConnection.onaddstream=function(c){g.options.streams.remote=c.stream};d()};t.prototype.initiate=function(){function c(c){d.peerConnection.setLocalDescription(new z(c),function(){n(d,"onmessage",{type:"offer",description:c.sdp,port:d.options.ports.local})},function(c){r(d,"onerror",c)})}var d=this;this.initialize(function(){d.peerConnection.createOffer(c,function(c){r(d,"onerror",c)})})};t.prototype.handleIce=function(c){var d=
this;this.initialize(function(){d.peerConnection.remoteDescription&&d.peerConnection.addIceCandidate(new I(c),function(c){r(d,"onerror",c)})})};t.prototype.handleOffer=function(c){function d(){h.peerConnection.createAnswer(g,function(c){r(h,"onerror",c)})}function g(c){h.peerConnection.setLocalDescription(new z(c),function(){n(h,"onmessage",{type:"answer",description:c.sdp,port:h.options.ports.local});var b=new E(h.peerConnection,h.options,!1);n(h,"oncomplete",[b])},function(b){r(h,"onerror",b)})}
var h=this;this.initialize(function(){h.peerConnection.setRemoteDescription(new z(c),d,function(c){r(h,"onerror",c)})})};t.prototype.handleAnswer=function(c){function d(){var c=new E(g.peerConnection,g.options,!0);n(g,"oncomplete",[c])}var g=this;this.initialize(function(){g.peerConnection.setRemoteDescription(new z(c),d,function(c){r(g,"onerror",c)})})};t.prototype.process=function(c){switch(c.type){case "ice":break;case "offer":this.options.ports.remote=c.port;this.handleOffer({type:"offer",sdp:c.description});
break;case "answer":this.options.ports.remote=c.port;this.handleAnswer({type:"answer",sdp:c.description});break;default:r(this,"onerror","unknown message")}};var U=1;E.prototype.close=function(){console.log("close connection");this.connected&&this._control.send("QUIT");this.connected=!1;this.peerConnection.close();this.connectionTimer&&(window.clearInterval(this.connectionTimer),this.connectionTimer=null);this.pingTimer&&(window.clearInterval(this.pingTimer),this.pingTimer=null);this.peerConnection=
null;n(this,"ondisconnect",[])};F.prototype.listen=function(c){if(!this.broker.checkState(j.ROUTED))return L(this.queues.connected,this,"listen",[c]);c=c||{};c.url=c.url||window.location.toString();c.listed=void 0!==c.listed?c.listed:!0;c.metadata=c.metadata||{};this.broker.listen(c)};F.prototype.ignore=function(){throw Error("not implemented");};F.prototype.connect=function(c){if(!this.broker.checkState(j.ROUTED))return L(this.queues.connected,this,"connect",[c]);var d=this;if(this.pending.hasOwnProperty(c))throw Error("already connecting to this host");
n(d,"onpending",[c]);var g=this.pending[c]=new t(this.options);g.oncomplete=function(g){delete d.pending[c];g.route=c;g.onconnect=function(){n(d,"onconnection",[g])}};g.onmessage=function(g){d.broker.send(c,g)};g.onerror=function(g){delete d.pending[c];r(d,"onerror",g)};g.initiate()};return F})})("function"==typeof define&&define.amd?define:function(K,l){"object"===typeof exports?module.exports=l():this.RTCPeer=l()},this);
