(function(N,m){N(["module"],function(p){function k(d,c,h){Array.isArray(h)||(h=[h]);c in d&&"function"===typeof d[c]&&d[c].apply(d,h)}function q(d,c,h){h instanceof Error||(h=Error(h));k(d,c,[h])}function Q(d,c,h,f){return d?(d.push([c,h,f]),!0):!1}function R(d){for(;d.length;){var c=d.shift();k(c[0],c[1],c[2])}}function S(d){this.name="PendingConnectionAbortError";this.message=d||""}function T(d){this.name="ConnectionFailedError";this.message=d||""}function l(d){this.brokerUrl=d;this.state=l.OFFLINE;
this.route=this.socket=this.onerror=this.onreceive=this.onstatechange=null}function z(){this.connectionTimeout=10*K;this.pingTimeout=1*K;this.onerror=this.oncomplete=this.onmessage=null;this.complete=!1;this.ports={local:V++,remote:null};this.streams={local:null,remote:null};this.initiator=!1;this.peerConnection=null;this.channels={};this._pending={}}function w(d){this.options=d;this.connectionOptions=this.connectionServers=null;this.channelOptions={RELIABLE:{},UNRELIABLE:{outOfOrderAllowed:!0,maxRetransmitNum:0}}}
function x(d){this.options=d;this.connectionServers={iceServers:[{url:"stun:23.21.150.121"}]};this.connectionOptions={optional:[{RtpDataChannels:!0}]};this.channelOptions={RELIABLE:{reliable:!1},UNRELIABLE:{reliable:!1}}}function L(d,c,h,f){function j(){n.connected&&(this.connectionTimer=null,!1===n.messageFlag?(n.channels["@control"].send("ping"),this.pingTimer=window.setTimeout(b,d.pingTimeout)):(n.messageFlag=!1,this.connectionTimer=window.setTimeout(j,d.connectionTimeout)))}function b(){n.connected&&
(this.pingTimer=null,!1===n.messageFlag?(n.connected=!1,n.close()):(n.messageFlag=!1,this.connectionTimer=window.setTimeout(j,d.connectionTimeout)))}var n=this;this.id=W++;this.streams=h;this.messageFlag=this.connected=!1;this.onerror=this.ondisconnect=this.onmessage=null;this.peerConnection=c;this.channels=f;this.pingTimer=this.connectionTimer=null;Object.keys(this.channels).forEach(function(b){var c=n.channels[b];b.match("^@")||(c.onmessage=function(c){n.messageFlag=!0;k(n,"onmessage",[b,c])})});
this.channels["@control"].onmessage=function(b){n.messageFlag=!0;n.connected&&(b=b.data,"ping"===b?n.channels["@control"].send("pong"):"pong"!==b&&"quit"===b&&n.close())};this.connected=!0;this.connectionTimer=window.setTimeout(j,d.connectionTimeout)}function B(d,c){this.route=d;this.incoming=c;this.proceed=!0}function t(d,c){var h=this;this.brokerUrl=d;this.options=c=c||{};c.binaryType=c.binaryType||"arraybuffer";c.connectionTimeout=c.connectionTimeout||10*K;c.pingTimeout=c.pingTimeout||1*K;this.onerror=
this.onroute=this.onpending=this.onconnection=null;this.broker=new l(d);this.pending={};this.queues={connected:[],listening:[]};this.broker.onstatechange=function(c,d){h.queues.connected.length&&h.broker.checkState(l.ROUTED)&&(R(h.queues.connected),h.queues.listening.length&&h.broker.checkState(l.LISTENING)&&R(h.queues.listening));d&l.ROUTED&&k(h,"onroute",h.broker.route)};this.broker.onreceive=function(c,d){var b;if(h.pending.hasOwnProperty(c))b=h.pending[c];else{if(!h.broker.checkState(l.LISTENING))return;
var j=new B(c,!0);k(h,"onpending",[j]);if(!j.accept)return;b=h.pending[c]=new E(h.options);b.oncomplete=function(){var d=new L(h.options,b.peerConnection,b.streams,b.channels);d.route=c;delete h.pending[c];k(h,"onconnection",[d])};b.onmessage=function(b){h.broker.send(c,b)};b.onerror=function(b){delete h.pending[c];k(h,"onerror",[b])}}b.process(d)};this.broker.connect()}var j="undefined"===typeof p?{}:p.exports;(function(){var d="object"===typeof p?p.exports:j={};d.version="0.9.11";d.protocol=1;d.transports=
[];d.j=[];d.sockets={};d.connect=function(a,e){var g=d.util.parseUri(a),b,c;m&&m.location&&(g.protocol=g.protocol||m.location.protocol.slice(0,-1),g.host=g.host||(m.document?m.document.domain:m.location.hostname),g.port=g.port||m.location.port);b=d.util.uniqueUri(g);var f={host:g.host,secure:"https"==g.protocol,port:g.port||("https"==g.protocol?443:80),query:g.query||""};d.util.merge(f,e);if(f["force new connection"]||!d.sockets[b])c=new d.Socket(f);!f["force new connection"]&&c&&(d.sockets[b]=c);
c=c||d.sockets[b];return c.of(1<g.path.length?g.path:"")};var c=("undefined"!=typeof j?j:p.exports).util={},h=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");c.parseUri=function(a){a=h.exec(a||"");for(var e={},g=14;g--;)e[f[g]]=a[g]||"";return e};
c.uniqueUri=function(a){var e=a.protocol,g=a.host;a=a.port;"document"in m?(g=g||document.domain,a=a||("https"==e&&"https:"!==document.location.protocol?443:document.location.port)):(g=g||"localhost",!a&&"https"==e&&(a=443));return(e||"http")+"://"+g+":"+(a||80)};c.query=function(a,e){var g=c.chunkQuery(a||""),b=[];c.merge(g,c.chunkQuery(e||""));for(var d in g)g.hasOwnProperty(d)&&b.push(d+"="+g[d]);return b.length?"?"+b.join("&"):""};c.chunkQuery=function(a){var e={};a=a.split("&");for(var g=0,b=
a.length,c;g<b;++g)c=a[g].split("="),c[0]&&(e[c[0]]=c[1]);return e};var A=!1;c.load=function(a){if("document"in m&&"complete"===document.readyState||A)return a();c.on(m,"load",a,!1)};c.on=function(a,e,g,b){a.attachEvent?a.attachEvent("on"+e,g):a.addEventListener&&a.addEventListener(e,g,b)};c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null};
"undefined"!=typeof window&&c.load(function(){A=!0});c.defer=function(a){if(!c.ua.webkit||"undefined"!=typeof importScripts)return a();c.load(function(){setTimeout(a,100)})};c.merge=function(a,e,g,b){b=b||[];g="undefined"==typeof g?2:g;for(var d in e)e.hasOwnProperty(d)&&0>c.indexOf(b,d)&&("object"!==typeof a[d]||!g?(a[d]=e[d],b.push(e[d])):c.merge(a[d],e[d],g-1,b));return a};c.mixin=function(a,e){c.merge(a.prototype,e.prototype)};c.inherit=function(a,e){function g(){}g.prototype=e.prototype;a.prototype=
new g};c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.intersect=function(a,e){for(var g=[],b=a.length>e.length?a:e,d=a.length>e.length?e:a,f=0,h=d.length;f<h;f++)~c.indexOf(b,d[f])&&g.push(d[f]);return g};c.indexOf=function(a,e,g){var b=a.length;for(g=0>g?0>g+b?0:g+b:g||0;g<b&&a[g]!==e;g++);return b<=g?-1:g};c.toArray=function(a){for(var e=[],g=0,b=a.length;g<b;g++)e.push(a[g]);return e};c.ua={};var b=c.ua,n;if(n="undefined"!=typeof XMLHttpRequest)a:{try{var l=
new XMLHttpRequest}catch(q){n=!1;break a}n=void 0!=l.withCredentials}b.hasCORS=n;c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent);var k="undefined"!=typeof j?j:p.parent.exports,b=function(){};("undefined"!=typeof j?j:p.exports).EventEmitter=b;b.prototype.on=function(a,e){this.$events||(this.$events={});this.$events[a]?k.util.isArray(this.$events[a])?this.$events[a].push(e):this.$events[a]=
[this.$events[a],e]:this.$events[a]=e;return this};b.prototype.addListener=b.prototype.on;b.prototype.once=function(a,e){function g(){b.removeListener(a,g);e.apply(this,arguments)}var b=this;g.listener=e;this.on(a,g);return this};b.prototype.removeListener=function(a,e){if(this.$events&&this.$events[a]){var g=this.$events[a];if(k.util.isArray(g)){for(var b=-1,c=0,d=g.length;c<d;c++)if(g[c]===e||g[c].listener&&g[c].listener===e){b=c;break}if(0>b)return this;g.splice(b,1);g.length||delete this.$events[a]}else(g===
e||g.listener&&g.listener===e)&&delete this.$events[a]}return this};b.prototype.removeAllListeners=function(a){if(void 0===a)return this.$events={},this;this.$events&&this.$events[a]&&(this.$events[a]=null);return this};b.prototype.listeners=function(a){this.$events||(this.$events={});this.$events[a]||(this.$events[a]=[]);k.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]);return this.$events[a]};b.prototype.emit=function(a){if(!this.$events)return!1;var e=this.$events[a];if(!e)return!1;
var g=Array.prototype.slice.call(arguments,1);if("function"==typeof e)e.apply(this,g);else if(k.util.isArray(e))for(var e=e.slice(),b=0,c=e.length;b<c;b++)e[b].apply(this,g);else return!1;return!0};(function(a,e){function g(a){return 10>a?"0"+a:a}function b(a){h.lastIndex=0;return h.test(a)?'"'+a.replace(h,function(a){var e=A[a];return"string"===typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,e){var d,f,h,P,A=j,m,k=e[a];k instanceof Date&&(k=isFinite(a.valueOf())?
a.getUTCFullYear()+"-"+g(a.getUTCMonth()+1)+"-"+g(a.getUTCDate())+"T"+g(a.getUTCHours())+":"+g(a.getUTCMinutes())+":"+g(a.getUTCSeconds())+"Z":null);"function"===typeof l&&(k=l.call(e,a,k));switch(typeof k){case "string":return b(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);case "object":if(!k)return"null";j+=n;m=[];if("[object Array]"===Object.prototype.toString.apply(k)){P=k.length;for(d=0;d<P;d+=1)m[d]=c(d,k)||"null";h=0===m.length?"[]":j?"[\n"+
j+m.join(",\n"+j)+"\n"+A+"]":"["+m.join(",")+"]";j=A;return h}if(l&&"object"===typeof l){P=l.length;for(d=0;d<P;d+=1)"string"===typeof l[d]&&(f=l[d],(h=c(f,k))&&m.push(b(f)+(j?": ":":")+h))}else for(f in k)Object.prototype.hasOwnProperty.call(k,f)&&(h=c(f,k))&&m.push(b(f)+(j?": ":":")+h);h=0===m.length?"{}":j?"{\n"+j+m.join(",\n"+j)+"\n"+A+"}":"{"+m.join(",")+"}";j=A;return h}}if(e&&e.parse)return a.JSON={parse:e.parse,stringify:e.stringify};var d=a.JSON={},f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,n,A={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;d.stringify=function(a,e,g){var b;n=j="";if("number"===typeof g)for(b=0;b<g;b+=1)n+=" ";else"string"===typeof g&&(n=g);if((l=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return c("",{"":a})};d.parse=function(a,e){function g(a,b){var d,
c,f=a[b];if(f&&"object"===typeof f)for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(c=g(f,d),void 0!==c?f[d]=c:delete f[d]);return e.call(a,b,f)}var b;a=String(a);f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),
"function"===typeof e?g({"":b},""):b;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof j?j:p.exports,"undefined"!==typeof JSON?JSON:void 0);var b="undefined"!=typeof j?j:p.parent.exports,r=("undefined"!=typeof j?j:p.exports).parser={},w=r.packets="disconnect connect heartbeat message json event ack error noop".split(" "),x=r.reasons=["transport not supported","client not handshaken","unauthorized"],z=r.advice=["reconnect"],t=b.JSON,D=b.util.indexOf;r.encodePacket=function(a){var e=D(w,a.type),
g=a.id||"",b=a.endpoint||"",d=a.ack,c=null;switch(a.type){case "error":var f=a.reason?D(x,a.reason):"";a=a.advice?D(z,a.advice):"";if(""!==f||""!==a)c=f+(""!==a?"+"+a:"");break;case "message":""!==a.data&&(c=a.data);break;case "event":c={name:a.name};a.args&&a.args.length&&(c.args=a.args);c=t.stringify(c);break;case "json":c=t.stringify(a.data);break;case "connect":a.qs&&(c=a.qs);break;case "ack":c=a.ackId+(a.args&&a.args.length?"+"+t.stringify(a.args):"")}e=[e,g+("data"==d?"+":""),b];null!==c&&void 0!==
c&&e.push(c);return e.join(":")};r.encodePayload=function(a){var e="";if(1==a.length)return a[0];for(var g=0,b=a.length;g<b;g++)e+="\ufffd"+a[g].length+"\ufffd"+a[g];return e};var K=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(a){var e=a.match(K);if(!e)return{};var g=e[2]||"";a=e[5]||"";var b={type:w[e[1]],endpoint:e[4]||""};g&&(b.id=g,b.ack=e[3]?"data":!0);switch(b.type){case "error":e=a.split("+");b.reason=x[e[0]]||"";b.advice=z[e[1]]||"";break;case "message":b.data=a||
"";break;case "event":try{var c=t.parse(a);b.name=c.name;b.args=c.args}catch(d){}b.args=b.args||[];break;case "json":try{b.data=t.parse(a)}catch(f){}break;case "connect":b.qs=a||"";break;case "ack":if(e=a.match(/^([0-9]+)(\+)?(.*)/))if(b.ackId=e[1],b.args=[],e[3])try{b.args=e[3]?t.parse(e[3]):[]}catch(h){}}return b};r.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var e=[],g=1,b="";g<a.length;g++)"\ufffd"==a.charAt(g)?(e.push(r.decodePacket(a.substr(g+1).substr(0,b))),g+=Number(b)+1,b=""):
b+=a.charAt(g);return e}return[r.decodePacket(a)]};var O="undefined"!=typeof j?j:p.parent.exports,b=function(a,e){this.socket=a;this.sessid=e};("undefined"!=typeof j?j:p.exports).Transport=b;O.util.mixin(b,O.EventEmitter);b.prototype.heartbeats=function(){return!0};b.prototype.onData=function(a){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==a&&(a=O.parser.decodePayload(a))&&a.length)for(var e=0,g=a.length;e<g;e++)this.onPacket(a[e]);
return this};b.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1);this.socket.onPacket(a);return this};b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};b.prototype.onDisconnect=function(){this.isOpen&&this.close();this.clearTimeouts();
this.socket.onDisconnect();return this};b.prototype.onConnect=function(){this.socket.onConnect();return this};b.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)};b.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};b.prototype.packet=function(a){this.send(O.parser.encodePacket(a))};b.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})};b.prototype.onOpen=function(){this.isOpen=
!0;this.clearCloseTimeout();this.socket.onOpen()};b.prototype.onClose=function(){this.isOpen=!1;this.socket.onClose();this.onDisconnect()};b.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+O.protocol+"/"+this.name+"/"+this.sessid};b.prototype.ready=function(a,e){e.call(this)};var s="undefined"!=typeof j?j:p.parent.exports,b=function(a){this.options={port:80,secure:!1,document:"document"in m?document:!1,resource:"socket.io",
transports:s.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1};s.util.merge(this.options,a);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||s.util.ua.hasCORS)){var e=
this;s.util.on(m,"beforeunload",function(){e.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()},L=function(){};("undefined"!=typeof j?j:p.exports).Socket=b;s.util.mixin(b,s.EventEmitter);b.prototype.of=function(a){this.namespaces[a]||(this.namespaces[a]=new s.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"}));return this.namespaces[a]};b.prototype.publish=function(){this.emit.apply(this,arguments);var a,e;for(e in this.namespaces)this.namespaces.hasOwnProperty(e)&&
(a=this.of(e),a.$emit.apply(a,arguments))};b.prototype.handshake=function(a){function e(e){e instanceof Error?(g.connecting=!1,g.onError(e.message)):a.apply(null,e.split(":"))}var g=this,b=this.options,b=["http"+(b.secure?"s":"")+":/",b.host+":"+b.port,b.resource,s.protocol,s.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!s.util.ua.hasCORS){var c=document.getElementsByTagName("script")[0],d=document.createElement("script");d.src=b+"&jsonp="+s.j.length;c.parentNode.insertBefore(d,
c);s.j.push(function(a){e(a);d.parentNode.removeChild(d)})}else{var f=s.util.request();f.open("GET",b,!0);this.isXDomain()&&(f.withCredentials=!0);f.onreadystatechange=function(){if(4==f.readyState)if(f.onreadystatechange=L,200==f.status)e(f.responseText);else if(403==f.status)g.onError(f.responseText);else g.connecting=!1,!g.reconnecting&&g.onError(f.responseText)};f.send(null)}};b.prototype.getTransport=function(a){a=a||this.transports;for(var e=0,b;b=a[e];e++)if(s.Transport[b]&&s.Transport[b].check(this)&&
(!this.isXDomain()||s.Transport[b].xdomainCheck(this)))return new s.Transport[b](this,this.sessionid);return null};b.prototype.connect=function(a){if(this.connecting)return this;var e=this;e.connecting=!0;this.handshake(function(b,c,d,f){function h(a){e.transport&&e.transport.clearTimeouts();e.transport=e.getTransport(a);if(!e.transport)return e.publish("connect_failed");e.transport.ready(e,function(){e.connecting=!0;e.publish("connecting",e.transport.name);e.transport.open();e.options["connect timeout"]&&
(e.connectTimeoutTimer=setTimeout(function(){if(!e.connected&&(e.connecting=!1,e.options["try multiple transports"])){for(var a=e.transports;0<a.length&&a.splice(0,1)[0]!=e.transport.name;);a.length?h(a):e.publish("connect_failed")}},e.options["connect timeout"]))})}e.sessionid=b;e.closeTimeout=1E3*d;e.heartbeatTimeout=1E3*c;e.transports||(e.transports=e.origTransports=f?s.util.intersect(f.split(","),e.options.transports):e.options.transports);e.setHeartbeatTimeout();h(e.transports);e.once("connect",
function(){clearTimeout(e.connectTimeoutTimer);a&&"function"==typeof a&&a()})});return this};b.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}};b.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};b.prototype.setBuffer=function(a){this.doBuffer=
a;!a&&(this.connected&&this.buffer.length)&&(this.options.manualFlush||this.flushBuffer())};b.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};b.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};b.prototype.disconnectSync=function(){var a=s.util.request(),e=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,
s.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",e,!1);a.send(null);this.onDisconnect("booted")};b.prototype.isXDomain=function(){var a=m.location.port||("https:"==m.location.protocol?443:80);return this.options.host!==m.location.hostname||this.options.port!=a};b.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};b.prototype.onOpen=function(){this.open=!0};b.prototype.onClose=function(){this.open=
!1;clearTimeout(this.heartbeatTimeoutTimer)};b.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};b.prototype.onError=function(a){if(a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting))this.disconnect(),this.options.reconnect&&this.reconnect();this.publish("error",a&&a.reason?a.reason:a)};b.prototype.onDisconnect=function(a){var e=this.connected,b=this.connecting;this.open=this.connecting=this.connected=!1;if(e||b)this.transport.close(),this.transport.clearTimeouts(),
e&&(this.publish("disconnect",a),"booted"!=a&&(this.options.reconnect&&!this.reconnecting)&&this.reconnect())};b.prototype.reconnect=function(){function a(){if(b.connected){for(var a in b.namespaces)b.namespaces.hasOwnProperty(a)&&""!==a&&b.namespaces[a].packet({type:"connect"});b.publish("reconnect",b.transport.name,b.reconnectionAttempts)}clearTimeout(b.reconnectionTimer);b.removeListener("connect_failed",e);b.removeListener("connect",e);b.reconnecting=!1;delete b.reconnectionAttempts;delete b.reconnectionDelay;
delete b.reconnectionTimer;delete b.redoTransports;b.options["try multiple transports"]=d}function e(){if(b.reconnecting){if(b.connected)return a();if(b.connecting&&b.reconnecting)return b.reconnectionTimer=setTimeout(e,1E3);b.reconnectionAttempts++>=c?b.redoTransports?(b.publish("reconnect_failed"),a()):(b.on("connect_failed",e),b.options["try multiple transports"]=!0,b.transports=b.origTransports,b.transport=b.getTransport(),b.redoTransports=!0,b.connect()):(b.reconnectionDelay<f&&(b.reconnectionDelay*=
2),b.connect(),b.publish("reconnecting",b.reconnectionDelay,b.reconnectionAttempts),b.reconnectionTimer=setTimeout(e,b.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var b=this,c=this.options["max reconnection attempts"],d=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(e,this.reconnectionDelay);this.on("connect",
e)};var B="undefined"!=typeof j?j:p.parent.exports,b=function(a,b){this.socket=a;this.name=b||"";this.flags={};this.json=new E(this,"json");this.ackPackets=0;this.acks={}},E=function(a,b){this.namespace=a;this.name=b};("undefined"!=typeof j?j:p.exports).SocketNamespace=b;B.util.mixin(b,B.EventEmitter);b.prototype.$emit=B.EventEmitter.prototype.emit;b.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};b.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);
this.flags={};return this};b.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b);return this.packet(c)};b.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1));d.args=b;return this.packet(d)};b.prototype.disconnect=function(){""===this.name?
this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));return this};b.prototype.onPacket=function(a){function b(){c.packet({type:"ack",args:B.util.toArray(arguments),ackId:a.id})}var c=this;switch(a.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(a.reason||"booted");else this.$emit("disconnect",a.reason);break;case "message":case "json":var d=["message",a.data];"data"==a.ack?d.push(b):a.ack&&this.packet({type:"ack",
ackId:a.id});this.$emit.apply(this,d);break;case "event":d=[a.name].concat(a.args);"data"==a.ack&&d.push(b);this.$emit.apply(this,d);break;case "ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case "error":if(a.advice)this.socket.onError(a);else"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}};E.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};
E.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,arguments)};var M="undefined"!=typeof j?j:p.parent.exports,b=function(a){M.Transport.apply(this,arguments)};("undefined"!=typeof j?j.Transport:p.exports).websocket=b;M.util.inherit(b,M.Transport);b.prototype.name="websocket";b.prototype.open=function(){var a=M.util.query(this.socket.options.query),b=this,c;c||(c=m.MozWebSocket||m.WebSocket);this.websocket=new c(this.prepareUrl()+a);this.websocket.onopen=
function(){b.onOpen();b.socket.setBuffer(!1)};this.websocket.onmessage=function(a){b.onData(a.data)};this.websocket.onclose=function(){b.onClose();b.socket.setBuffer(!0)};this.websocket.onerror=function(a){b.onError(a)};return this};b.prototype.send=M.util.ua.iDevice?function(a){var b=this;setTimeout(function(){b.websocket.send(a)},0);return this}:function(a){this.websocket.send(a);return this};b.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this};b.prototype.close=
function(){this.websocket.close();return this};b.prototype.onError=function(a){this.socket.onError(a)};b.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};b.check=function(){return"WebSocket"in m&&!("__addTask"in WebSocket)||"MozWebSocket"in m};b.xdomainCheck=function(){return!0};M.transports.push("websocket");if(!("undefined"==typeof window||window.WebSocket)){var v=window.console;if(!v||!v.log||!v.error)v={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?
("file:"==location.protocol&&v.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,f){var h=this;h.__id=WebSocket.__nextId++;WebSocket.__instances[h.__id]=h;h.readyState=WebSocket.CONNECTING;h.bufferedAmount=0;h.__events={};b?"string"==typeof b&&(b=[b]):b=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(h.__id,a,b,c||null,d||0,f||null)})},
0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||
(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var c=this.__events[a],d=c.length-1;0<=d;--d)if(c[d]===b){c.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||
"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=
function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",!1,!1,b,null,null,window,null);return c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},
WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,
"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||v.error("[WebSocket] swfobject.embedSWF failed")})}else v.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=
0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(c){v.error(c)}},0);return!0},WebSocket.__log=function(a){v.log(decodeURIComponent(a))},WebSocket.__error=function(a){v.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},
WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!a||!a.enabledPlugin||!a.enabledPlugin.filename?!1:a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):v.error("Flash Player >= 10.0.0 is required.")}var F=
"undefined"!=typeof j?j:p.parent.exports,u=function(a){a&&(F.Transport.apply(this,arguments),this.sendBuffer=[])},I=function(){};("undefined"!=typeof j?j.Transport:p.exports).XHR=u;F.util.inherit(u,F.Transport);u.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};u.prototype.payload=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(F.parser.encodePacket(a[c]));this.send(F.parser.encodePayload(b))};u.prototype.send=function(a){this.post(a);
return this};u.prototype.post=function(a){function b(){if(4==this.readyState)if(this.onreadystatechange=I,d.posting=!1,200==this.status)d.socket.setBuffer(!1);else d.onClose()}function c(){this.onload=I;d.socket.setBuffer(!1)}var d=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");m.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=c:this.sendXHR.onreadystatechange=b;this.sendXHR.send(a)};u.prototype.close=function(){this.onClose();return this};
u.prototype.request=function(a){var b=F.util.request(this.socket.isXDomain()),c=F.util.query(this.socket.options.query,"t="+ +new Date);b.open(a||"GET",this.prepareUrl()+c,!0);if("POST"==a)try{b.setRequestHeader?b.setRequestHeader("Content-type","text/plain;charset=UTF-8"):b.contentType="text/plain"}catch(d){}return b};u.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};u.check=function(a,b){try{var c=F.util.request(b),d=m.XDomainRequest&&c instanceof XDomainRequest,f=
a&&a.options&&a.options.secure?"https:":"http:",h=m.location&&f!=m.location.protocol;if(c&&(!d||!h))return!0}catch(j){}return!1};u.xdomainCheck=function(a){return u.check(a,!0)};var G="undefined"!=typeof j?j:p.parent.exports,b=function(a){G.Transport.XHR.apply(this,arguments)};("undefined"!=typeof j?j.Transport:p.exports).htmlfile=b;G.util.inherit(b,G.Transport.XHR);b.prototype.name="htmlfile";b.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();
this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio";this.doc.body.appendChild(a);this.iframe=this.doc.createElement("iframe");a.appendChild(this.iframe);var b=this,a=G.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+a;G.util.on(window,"unload",function(){b.destroy()})};b.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}};
b.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};b.prototype.close=function(){this.destroy();return G.Transport.XHR.prototype.close.call(this)};b.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile")&&G.Transport.XHR.check(a)}catch(b){}return!1};
b.xdomainCheck=function(){return!1};G.transports.push("htmlfile");var C="undefined"!=typeof j?j:p.parent.exports,b=function(){C.Transport.XHR.apply(this,arguments)},H=function(){};("undefined"!=typeof j?j.Transport:p.exports)["xhr-polling"]=b;C.util.inherit(b,C.Transport.XHR);C.util.merge(b,C.Transport.XHR);b.prototype.name="xhr-polling";b.prototype.heartbeats=function(){return!1};b.prototype.open=function(){C.Transport.XHR.prototype.open.call(this);return!1};b.prototype.get=function(){function a(){if(4==
this.readyState)if(this.onreadystatechange=H,200==this.status)d.onData(this.responseText),d.get();else d.onClose()}function b(){this.onerror=this.onload=H;d.retryCounter=1;d.onData(this.responseText);d.get()}function c(){d.retryCounter++;if(!d.retryCounter||3<d.retryCounter)d.onClose();else d.get()}if(this.isOpen){var d=this;this.xhr=this.request();m.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=c):this.xhr.onreadystatechange=a;this.xhr.send(null)}};b.prototype.onClose=
function(){C.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=H;try{this.xhr.abort()}catch(a){}this.xhr=null}};b.prototype.ready=function(a,b){var c=this;C.util.defer(function(){b.call(c)})};C.transports.push("xhr-polling");var y="undefined"!=typeof j?j:p.parent.exports,b=function(a){y.Transport["xhr-polling"].apply(this,arguments);this.index=y.j.length;var b=this;y.j.push(function(a){b._(a)})},J=m.document&&"MozAppearance"in m.document.documentElement.style;
("undefined"!=typeof j?j.Transport:p.exports)["jsonp-polling"]=b;y.util.inherit(b,y.Transport["xhr-polling"]);b.prototype.name="jsonp-polling";b.prototype.post=function(a){function b(){c();d.socket.setBuffer(!1)}function c(){d.iframe&&d.form.removeChild(d.iframe);try{n=document.createElement('<iframe name="'+d.iframeId+'">')}catch(a){n=document.createElement("iframe"),n.name=d.iframeId}n.id=d.iframeId;d.form.appendChild(n);d.iframe=n}var d=this,f=y.util.query(this.socket.options.query,"t="+ +new Date+
"&i="+this.index);if(!this.form){var h=document.createElement("form"),j=document.createElement("textarea"),k=this.iframeId="socketio_iframe_"+this.index,n;h.className="socketio";h.style.position="absolute";h.style.top="0px";h.style.left="0px";h.style.display="none";h.target=k;h.method="POST";h.setAttribute("accept-charset","utf-8");j.name="d";h.appendChild(j);document.body.appendChild(h);this.form=h;this.area=j}this.form.action=this.prepareUrl()+f;c();this.area.value=y.JSON.stringify(a);try{this.form.submit()}catch(l){}this.iframe.attachEvent?
n.onreadystatechange=function(){"complete"==d.iframe.readyState&&b()}:this.iframe.onload=b;this.socket.setBuffer(!0)};b.prototype.get=function(){var a=this,b=document.createElement("script"),c=y.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.prepareUrl()+c;b.onerror=function(){a.onClose()};c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c);this.script=
b;J&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};b.prototype._=function(a){this.onData(a);this.isOpen&&this.get();return this};b.prototype.ready=function(a,b){var c=this;if(!J)return b.call(this);y.util.load(function(){b.call(c)})};b.check=function(){return"document"in m};b.xdomainCheck=function(){return!0};y.transports.push("jsonp-polling");"function"===typeof N&&N.amd&&N([],function(){return j})})();var I;if(window.mozRTCPeerConnection)I=
window.mozRTCPeerConnection;else if(window.webkitRTCPeerConnection)I=window.webkitRTCPeerConnection;else if(window.RTCPeerConnection)I=window.RTCPeerConnection;else throw Error("RTCPeerConnection not supported");var r;if(window.mozRTCSessionDescription)r=window.mozRTCSessionDescription;else if(window.webkitRTCSessionDescription)r=window.webkitRTCSessionDescription;else if(window.RTCSessionDescription)r=window.RTCSessionDescription;else throw Error("RTCSessionDescription not supported");var H;if(window.mozRTCIceCandidate)H=
window.mozRTCIceCandidate;else if(window.webkitRTCIceCandidate)H=window.webkitRTCIceCandidate;else if(window.RTCIceCandidate)H=window.RTCIceCandidate;else throw Error("RTCIceCandidate not supported");var J;if(navigator.getUserMedia)J=navigator.getUserMedia.bind(navigator);else if(navigator.mozGetUserMedia)J=navigator.mozGetUserMedia.bind(navigator);else if(navigator.webkitGetUserMedia)J=navigator.webkitGetUserMedia.bind(navigator);else throw Error("getUserMedia not supported");var E;if(window.mozRTCPeerConnection)E=
w;else if(window.webkitRTCPeerConnection)E=x;else throw Error("unable to determine correct connection protocol");var K=1E3;S.prototype=Error.prototype;T.prototype=Error.prototype;var U={PendingConnectionAbortError:S,ConnectionFailedError:T};l.OFFLINE=0;l.CONNECTING=1;l.CONNECTED=2;l.ROUTED=16;l.LISTENING=32;l.prototype.setState=function(d,c){var h=c?0:240;this.state&=h>>>0;this.state|=d>>>0;k(this,"onstatechange",[this.state,(d|h&0)>>>0])};l.prototype.setFlag=function(d){this.state=(this.state|d)>>>
0;k(this,"onstatechange",[this.state,d])};l.prototype.clearFlag=function(d){d=~d>>>0;this.state=(this.state&d)>>>0;k(this,"onstatechange",[this.state,d])};l.prototype.checkState=function(d){return!!(this.state&d)};l.prototype.connect=function(){var d=this,c=j.connect(this.brokerUrl+"/peer",{"sync disconnect on unload":!0});c.on("connecting",function(){d.setState(l.CONNECTING,!0)});c.on("connect",function(){d.setState(l.CONNECTED,!0)});c.on("connect_failed",function(){d.setState(l.OFFLINE,!0)});c.on("route",
function(c){d.route=c;d.setFlag(l.ROUTED)});c.on("disconnect",function(){d.setState(l.OFFLINE,!0)});c.on("error",function(c){q(d,"onerror",c)});c.on("receive",function(c){k(d,"onreceive",[c.from,c.data])});this.socket=c};l.prototype.disconnect=function(){return this.checkState(l.CONNECTED)?(this.socket.disconnect(),this.setState(l.OFFLINE,!0),!0):!1};l.prototype.listen=function(d){var c=this;this.checkState(l.CONNECTED)&&this.socket.emit("listen",d,function(d){d&&d.error?q(c,"onerror",Error(d.error)):
c.setFlag(l.LISTENING)})};l.prototype.ignore=function(){var d=this;this.checkState(l.CONNECTED)&&this.socket.emit("ignore",null,function(c){c&&c.error?q(d,"onerror",Error(c.error)):d.clearFlag(l.LISTENING)})};l.prototype.send=function(d,c){var h=this;this.checkState(l.CONNECTED)&&this.socket.emit("send",{to:d,data:c},function(c){c&&c.error&&q(h,"onerror",Error(c.error))})};var D={reliable:"RELIABLE",unreliable:"UNRELIABLE","@control":"RELIABLE"},V=1;z.prototype.process=function(d){switch(d.type){case "ice":(d=
JSON.parse(d.candidate))&&this.handleIce(d);break;case "offer":this.ports.remote=d.port;this.handleOffer({type:"offer",sdp:d.description});break;case "answer":this.ports.remote=d.port;this.handleAnswer({type:"answer",sdp:d.description});break;case "abort":this.handleAbort();break;default:q(this,"onerror","unknown message")}};z.prototype.handleAbort=function(){q(this,"onerror",Error(U.RTCConnectProtocolAbort))};z.prototype.initialize=function(d){function c(f){f=!j&&!b?!0:f;var j=!!h.options.video,
b=!!h.options.audio;J({video:j,audio:!j&&!b?!0:b,fake:f},function(b){h.peerConnection.addStream(b);h.streams.local=b;d()},function(b){console.error("!",b);f?q(h,"onerror",b):c(!0)})}var h=this;if(this.peerConnection)return d();this.peerConnection=new I(this.connectionServers,this.connectionOptions);this.peerConnection.onicecandidate=function(c){c={type:"ice",candidate:JSON.stringify(c.candidate)};k(h,"onmessage",c)};this.peerConnection.onaddstream=function(c){h.streams.remote=c.stream};this.peerConnection.onstatechange=
function(c){console.log(c.target.readyState)};c()};z.prototype.handleIce=function(d){var c=this;this.initialize(function(){c.peerConnection.remoteDescription&&c.peerConnection.addIceCandidate(new H(d),function(d){q(c,"onerror",d)})})};w.prototype=new z;w.prototype.constructor=w;w.prototype.initiate=function(){function d(d){c.peerConnection.setLocalDescription(new r(d),function(){k(c,"onmessage",{type:"offer",description:d.sdp,port:c.ports.local})},function(d){q(c,"onerror",d)})}var c=this;this.initiator=
!0;this.initialize(function(){c.peerConnection.createOffer(d,function(d){q(c,"onerror",d)})})};w.prototype.handleOffer=function(d){function c(){f.peerConnection.createAnswer(h,function(c){q(f,"onerror",c)})}function h(c){f.peerConnection.setLocalDescription(new r(c),function(){var b={type:"answer",description:c.sdp,port:f.ports.local},d=Object.keys(D);f.peerConnection.ondatachannel=function(b){f.channels[b.label]=b;Object.keys(f.channels).length===d.length&&(f.complete=!0,k(f,"oncomplete",[]));b.onerror=
function(b){console.error(b);q(f,"onerror",b)}};f.peerConnection.connectDataConnection&&f.peerConnection.connectDataConnection(f.ports.local,f.ports.remote);k(f,"onmessage",b)},function(b){q(f,"onerror",b)})}var f=this;this.initialize(function(){f.peerConnection.setRemoteDescription(new r(d),c,function(c){q(f,"onerror",c)})})};w.prototype.handleAnswer=function(d){function c(){f.peerConnection.onconnection=h;f.peerConnection.connectDataConnection&&f.peerConnection.connectDataConnection(f.ports.local,
f.ports.remote)}function h(){var c=Object.keys(D);c.forEach(function(b){try{var d=f._pending[b]=f.peerConnection.createDataChannel(b,{})}catch(h){console.error(b,h)}d.binaryType=f.options.binaryType;d.onopen=function(){f.channels[b]=d;delete f._pending[b];Object.keys(f.channels).length===c.length&&(f.complete=!0,k(f,"oncomplete",[]))};d.onerror=function(b){console.error(b);q(f,"onerror",b)}})}var f=this;this.initialize(function(){f.peerConnection.setRemoteDescription(new r(d),c,function(c){q(f,"onerror",
c)})})};x.prototype=new z;x.prototype.constructor=x;x.prototype.initiate=function(){function d(d){c.peerConnection.setLocalDescription(new r(d),function(){k(c,"onmessage",{type:"offer",description:d.sdp,port:c.ports.local})},function(d){q(c,"onerror",d)})}var c=this;this.initiator=!0;this.initialize(function(){var h=Object.keys(D);h.forEach(function(d){var j=c._pending[d]=c.peerConnection.createDataChannel(d,c.channelOptions[D[d]]);j.binaryType=c.options.binaryType;j.onopen=function(){c.channels[d]=
j;delete c._pending[d];Object.keys(c.channels).length===h.length&&(c.complete=!0,k(c,"oncomplete",[]))};j.onerror=function(b){console.error(b);q(c,"onerror",b)}});c.peerConnection.createOffer(d,function(d){q(c,"onerror",d)})})};x.prototype.handleOffer=function(d){function c(){f.peerConnection.createAnswer(h,function(c){q(f,"onerror",c)})}function h(c){f.peerConnection.setLocalDescription(new r(c),function(){k(f,"onmessage",{type:"answer",description:c.sdp,port:f.ports.local})},function(b){q(f,"onerror",
b)})}var f=this;this.initialize(function(){var h=Object.keys(D);f.peerConnection.ondatachannel=function(b){var c=b.channel,d=c.label;f._pending[d]=c;c.onopen=function(){f.channels[d]=c;delete f._pending[d];Object.keys(f.channels).length===h.length&&(f.complete=!0,k(f,"oncomplete",[]))};c.onerror=function(b){console.error(b);q(f,"onerror",b)}};f.peerConnection.setRemoteDescription(new r(d),c,function(b){q(f,"onerror",b)})})};x.prototype.handleAnswer=function(d){function c(){}var h=this;this.initialize(function(){h.peerConnection.setRemoteDescription(new r(d),
c,function(c){q(h,"onerror",c)})})};var W=1;L.prototype.close=function(){console.log("close connection");this.connected&&this.channels["@control"].send("quit");this.connected=!1;this.peerConnection.close();this.connectionTimer&&(window.clearInterval(this.connectionTimer),this.connectionTimer=null);this.pingTimer&&(window.clearInterval(this.pingTimer),this.pingTimer=null);this.peerConnection=null;k(this,"ondisconnect",[])};L.prototype.send=function(d,c){this.channels[d].send(c)};B.prototype.accept=
function(){this.proceed=!0};B.prototype.reject=function(){this.proceed=!1};t.prototype.listen=function(d){if(!this.broker.checkState(l.ROUTED))return Q(this.queues.connected,this,"listen",[d]);d=d||{};d.url=d.url||window.location.toString();d.listed=void 0!==d.listed?d.listed:!0;d.metadata=d.metadata||{};this.broker.listen(d)};t.prototype.ignore=function(){throw Error("not implemented");};t.prototype.connect=function(d){if(!this.broker.checkState(l.ROUTED))return Q(this.queues.connected,this,"connect",
[d]);var c=this;if(this.pending.hasOwnProperty(d))throw Error("already connecting to this host");var h=new B(d,!1);k(c,"onpending",[h]);if(h.accept){var f=this.pending[d]=new E(this.options);f.oncomplete=function(){var h=new L(this.options,f.peerConnection,f.streams,f.channels);h.route=d;delete c.pending[d];k(c,"onconnection",[h])};f.onmessage=function(f){c.broker.send(d,f)};f.onerror=function(f){delete c.pending[d];q(c,"onerror",f)};f.initiate()}};t.prototype.close=function(){this.broker.disconnect()};
t.E=U;return t})})("function"==typeof define&&define.amd?define:function(N,m){"object"===typeof exports?module.exports=m():this.Peer=m()},this);
